<div class="max-w-xl mx-auto px-4">
  <h1 class="text-lg font-semibold mb-2">料理記録の新規登録</h1>

  <% if @cooking_record.errors.any? %>
    <ul>
      <% @cooking_record.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  <% end %>

  <%= form_with model: @cooking_record, class: "space-y-4" do |f| %>
    <div>
      <%= f.label :photo, '料理写真', class: "text-base font-bold" %><br>
      <div data-controller="photo-dropzone">
        <!-- 共通：全画面オーバーレイ（初期は非表示） -->
        <div class="fixed inset-0 z-50 hidden" data-photo-dropzone-target="overlay">
          <div class="absolute inset-0 bg-black/40"></div>
          <div class="absolute inset-0 flex flex-col items-center justify-center gap-3">
            <div class="scale-125">
              <!-- スピナーSVG -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48" fill="#ffc943">
                <circle cx="12" cy="12" r="12" opacity=".5">
                  <animate attributeName="r" values="0;12;0" keySplines="0.42 0.0 0.58 1.0" dur="2s" repeatCount="indefinite" begin="0"/>
                </circle>
                <circle cx="12" cy="12" r="0" opacity=".5">
                  <animate attributeName="r" values="0;12;0" keySplines="0.42 0.0 0.58 1.0" dur="2s" repeatCount="indefinite" begin="1s"/>
                </circle>
              </svg>
            </div>
            <p class="text-white text-sm font-medium">処理中...</p>
          </div>
        </div>
        <!-- PC：ドロップゾーン -->
        <div class="hidden md:block">
          <div class="border-2 border-dashed border-gray-300 rounded-md bg-gray-50 mt-2 px-6 py-10 text-center cursor-pointer hover:bg-gray-100 transition" data-photo-dropzone-target="zone" data-action="click->photo-dropzone#openDialog dragover->photo-dropzone#onDragOver dragleave->photo-dropzone#onDragLeave drop->photo-dropzone#onDrop">
            <p class="text-base font-semibold text-gray-800" data-photo-dropzone-target="title">ファイルを登録してください。</p>
            <p class="mt-2 text-sm text-gray-600" data-photo-dropzone-target="subtitle">ファイルを選択するか、ドラッグ&ドロップしてください。</p>
            <button type="button" class="mt-6 inline-flex items-center justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-50">ファイルを選択</button>
            <p class="text-xs mt-6">
              <span class="block text-gray-500">.jpg / .jpeg もしくは .heic /.heif ファイルを選択できます。</span>
              <span class="block text-[#B94043]">1つのファイルのみ選択でき、最大サイズは10MBです</span>
            </p>
          </div>
          <%= f.file_field :photo, accept: "image/jpeg,image/heic,image/heif", class: "hidden", data: { photo_dropzone_target: "inputPc", action: "change->photo-dropzone#onChange" } %>
        </div>
        <!-- SP：ファイル選択 -->
        <div class="md:hidden">
          <%= f.file_field :photo, accept: "image/jpeg,image/heic,image/heif", data: { photo_dropzone_target: "inputSp", action: "change->photo-dropzone#onChange" } %>
        </div>
        <!-- 共通：プレビュー -->
        <img class="mt-4 hidden rounded-md object-cover" data-photo-dropzone-target="preview"/>
      </div>
    </div>
    
    <div>
      <%= f.label :cooked_on, '作った日', class: "text-base font-bold" %><br>
      <%= f.date_field :cooked_on, class: "w-full mt-2 p-3 rounded-md text-sm bg-gray-200 text-gray-700" %>
    </div>

    <div>
      <%= f.label :dish_name, '料理名', class: "text-base font-bold" %><br>
      <%= f.text_field :dish_name, class: "w-full mt-2 p-3 rounded-md text-sm bg-gray-200" %>
    </div>

    <div>
      <%= f.label :recipe_url, '参考レシピ（URL）', class: "text-base font-bold" %><br>
      <%= f.text_field :recipe_url, class: "w-full mt-2 p-3 rounded-md text-sm bg-gray-200" %>
    </div>

    <div>
      <%= f.label :memo, 'メモ', class: "text-base font-bold" %><br>
      <%= f.text_area :memo, rows: 5, cols: 50, class: "w-full mt-2 p-3 rounded-md text-sm bg-gray-200" %>
    </div>

    <div>
      <%= f.submit '保存する', class: "mt-4 py-3 block w-full max-w-xl mx-auto flex items-center justify-center rounded-md font-bold text-white bg-[#FFC943]" %>
    </div>
  <% end %>
  <%= link_to 'ホームに戻る', dashboard_path, class: "mt-4 py-3 block w-full max-w-xl mx-auto flex items-center justify-center rounded-md font-bold text-white bg-[#212121]" %>
</div>
